/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery"],function(e,t,a){"use strict";let r=new class{constructor(){this.options={containerSelector:"#typo3-permissionList"},this.ajaxUrl=TYPO3.settings.ajaxUrls.user_access_permissions,this.setCheck=((e,t)=>{if(document.editform[t]){let a=document.editform[t].value;for(let t=1;t<=5;t++)document.editform[e+"["+t+"]"].checked=a&Math.pow(2,t-1)}}),this.checkChange=((e,t)=>{let a=0;for(let t=1;t<=5;t++)document.editform[e+"["+t+"]"].checked&&(a|=Math.pow(2,t-1));document.editform[t].value=a|("tx_beuser_system_beusertxpermission[check][perms_user]"===e?1:0),this.setCheck(e,t)}),this.setPermissions=(e=>{let t=e.data("page"),r=e.data("who"),o="#"+t+"_"+r;a.ajax({url:this.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{page:t,who:r,permissions:e.data("permissions"),mode:e.data("mode"),bits:e.data("bits")}}).done(e=>{a(o).replaceWith(e),a(o).find("span").tooltip()})}),this.toggleEditLock=(e=>{let t=e.data("page");a.ajax({url:this.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"toggle_edit_lock",page:t,editLockState:e.data("lockstate")}}).done(e=>{a("#el_"+t).replaceWith(e)})}),this.changeOwner=(e=>{let t=e.data("page");a.ajax({url:this.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"change_owner",page:t,ownerUid:e.data("owner"),newOwnerUid:a("#new_page_owner").val()}}).done(e=>{a("#o_"+t).replaceWith(e)})}),this.showChangeOwnerSelector=(e=>{let t=e.data("page");a.ajax({url:this.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"show_change_owner_selector",page:t,ownerUid:e.data("owner"),username:e.data("username")}}).done(e=>{a("#o_"+t).replaceWith(e)})}),this.restoreOwner=(e=>{let t=e.data("page"),r=e.data("username"),o=r;void 0===r&&(o=(r=a("<span>",{class:"not_set",text:"[not set]"})).html(),r=r.text());let s=a("<span/>",{id:"o_"+t}),n=a("<a/>",{class:"ug_selector changeowner","data-page":t,"data-owner":e.data("owner"),"data-username":o,text:r});s.append(n),a("#o_"+t).replaceWith(s)}),this.changeGroup=(e=>{let t=e.data("page");a.ajax({url:this.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"change_group",page:t,groupUid:e.data("groupId"),newGroupUid:a("#new_page_group").val()}}).done(e=>{a("#g_"+t).replaceWith(e)})}),this.showChangeGroupSelector=(e=>{let t=e.data("page");a.ajax({url:this.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"show_change_group_selector",page:t,groupUid:e.data("groupId"),groupname:e.data("groupname")}}).done(e=>{a("#g_"+t).replaceWith(e)})}),this.restoreGroup=(e=>{let t=e.data("page"),r=e.data("groupname"),o=r;void 0===r&&(o=(r=a("<span>",{class:"not_set",text:"[not set]"})).html(),r=r.text());let s=a("<span/>",{id:"g_"+t}),n=a("<a/>",{class:"ug_selector changegroup","data-page":t,"data-group":e.data("groupId"),"data-groupname":o,text:r});s.append(n),a("#g_"+t).replaceWith(s)}),this.initializeEvents=(()=>{a(this.options.containerSelector).on("click",".change-permission",e=>{e.preventDefault(),this.setPermissions(a(e.currentTarget))}).on("click",".editlock",e=>{e.preventDefault(),this.toggleEditLock(a(e.currentTarget))}).on("click",".changeowner",e=>{e.preventDefault(),this.showChangeOwnerSelector(a(e.currentTarget))}).on("click",".changegroup",e=>{e.preventDefault(),this.showChangeGroupSelector(a(e.currentTarget))}).on("click",".restoreowner",e=>{e.preventDefault(),this.restoreOwner(a(e.currentTarget))}).on("click",".saveowner",e=>{e.preventDefault(),this.changeOwner(a(e.currentTarget))}).on("click",".restoregroup",e=>{e.preventDefault(),this.restoreGroup(a(e.currentTarget))}).on("click",".savegroup",e=>{e.preventDefault(),this.changeGroup(a(e.currentTarget))})}),this.initializeEvents()}};return TYPO3.Permissions=r,r});