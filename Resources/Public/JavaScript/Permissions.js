/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","jquery"],function(e,t,a){"use strict";var n=new(function(){return function(){var e=this;this.options={containerSelector:"#typo3-permissionList"},this.ajaxUrl=TYPO3.settings.ajaxUrls.user_access_permissions,this.setCheck=function(e,t){if(document.editform[t])for(var a=document.editform[t].value,n=1;n<=5;n++)document.editform[e+"["+n+"]"].checked=a&Math.pow(2,n-1)},this.checkChange=function(t,a){for(var n=0,o=1;o<=5;o++)document.editform[t+"["+o+"]"].checked&&(n|=Math.pow(2,o-1));document.editform[a].value=n|("tx_beuser_system_beusertxpermission[check][perms_user]"===t?1:0),e.setCheck(t,a)},this.jumpToUrl=function(e){window.location.href=e},this.setPermissions=function(t){var n=t.data("page"),o=t.data("who"),r="#"+n+"_"+o;a.ajax({url:e.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{page:n,who:o,permissions:t.data("permissions"),mode:t.data("mode"),bits:t.data("bits")}}).done(function(e){a(r).replaceWith(e),a(r).find("span").tooltip()})},this.toggleEditLock=function(t){var n=t.data("page");a.ajax({url:e.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"toggle_edit_lock",page:n,editLockState:t.data("lockstate")}}).done(function(e){a("#el_"+n).replaceWith(e)})},this.changeOwner=function(t){var n=t.data("page");a.ajax({url:e.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"change_owner",page:n,ownerUid:t.data("owner"),newOwnerUid:a("#new_page_owner").val()}}).done(function(e){a("#o_"+n).replaceWith(e)})},this.showChangeOwnerSelector=function(t){var n=t.data("page");a.ajax({url:e.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"show_change_owner_selector",page:n,ownerUid:t.data("owner"),username:t.data("username")}}).done(function(e){a("#o_"+n).replaceWith(e)})},this.restoreOwner=function(e){var t=e.data("page"),n=e.data("username"),o=n;void 0===n&&(o=(n=a("<span>",{class:"not_set",text:"[not set]"})).html(),n=n.text());var r=a("<span/>",{id:"o_"+t}),c=a("<a/>",{class:"ug_selector changeowner","data-page":t,"data-owner":e.data("owner"),"data-username":o,text:n});r.append(c),a("#o_"+t).replaceWith(r)},this.changeGroup=function(t){var n=t.data("page");a.ajax({url:e.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"change_group",page:n,groupUid:t.data("groupId"),newGroupUid:a("#new_page_group").val()}}).done(function(e){a("#g_"+n).replaceWith(e)})},this.showChangeGroupSelector=function(t){var n=t.data("page");a.ajax({url:e.ajaxUrl,type:"post",dataType:"html",cache:!1,data:{action:"show_change_group_selector",page:n,groupUid:t.data("groupId"),groupname:t.data("groupname")}}).done(function(e){a("#g_"+n).replaceWith(e)})},this.restoreGroup=function(e){var t=e.data("page"),n=e.data("groupname"),o=n;void 0===n&&(o=(n=a("<span>",{class:"not_set",text:"[not set]"})).html(),n=n.text());var r=a("<span/>",{id:"g_"+t}),c=a("<a/>",{class:"ug_selector changegroup","data-page":t,"data-group":e.data("groupId"),"data-groupname":o,text:n});r.append(c),a("#g_"+t).replaceWith(r)},this.initializeEvents=function(){a(e.options.containerSelector).on("click",".change-permission",function(t){t.preventDefault(),e.setPermissions(a(t.currentTarget))}).on("click",".editlock",function(t){t.preventDefault(),e.toggleEditLock(a(t.currentTarget))}).on("click",".changeowner",function(t){t.preventDefault(),e.showChangeOwnerSelector(a(t.currentTarget))}).on("click",".changegroup",function(t){t.preventDefault(),e.showChangeGroupSelector(a(t.currentTarget))}).on("click",".restoreowner",function(t){t.preventDefault(),e.restoreOwner(a(t.currentTarget))}).on("click",".saveowner",function(t){t.preventDefault(),e.changeOwner(a(t.currentTarget))}).on("click",".restoregroup",function(t){t.preventDefault(),e.restoreGroup(a(t.currentTarget))}).on("click",".savegroup",function(t){t.preventDefault(),e.changeGroup(a(t.currentTarget))})},this.initializeEvents()}}());return TYPO3.Permissions=n,n});